<div class="container">
  <div class="header">
    <h1>Opérations Bancaires</h1>
    <a routerLink="/transactions" class="btn btn-secondary">Retour</a>
  </div>

  <div class="operation-tabs">
    <button
      (click)="setOperationType('depot')"
      [class.active]="operationType() === 'depot'"
      class="tab-btn tab-depot"
    >
      ⬇️ Dépôt
    </button>
    <button
      (click)="setOperationType('retrait')"
      [class.active]="operationType() === 'retrait'"
      class="tab-btn tab-retrait"
    >
      ⬆️ Retrait
    </button>
    <button
      (click)="setOperationType('virement')"
      [class.active]="operationType() === 'virement'"
      class="tab-btn tab-virement"
    >
      ↔️ Virement
    </button>
  </div>

  @if (error()) {
    <div class="alert alert-error">{{ error() }}</div>
  }

  @if (success()) {
    <div class="alert alert-success">{{ success() }}</div>
  }

  <form [formGroup]="operationForm" (ngSubmit)="onSubmit()" class="form">
    <div class="form-header">
      <h2>
        @switch (operationType()) {
          @case ('depot') { Effectuer un Dépôt }
          @case ('retrait') { Effectuer un Retrait }
          @case ('virement') { Effectuer un Virement }
        }
      </h2>
      <p class="form-description">
        @switch (operationType()) {
          @case ('depot') { Ajouter de l'argent sur le compte }
          @case ('retrait') { Retirer de l'argent du compte }
          @case ('virement') { Transférer de l'argent vers un autre compte }
        }
      </p>
    </div>

    <div class="form-group">
      <label for="numeroCompte">
        {{ operationType() === 'virement' ? 'Compte Source' : 'Numéro de Compte' }} *
      </label>
      <input
        type="text"
        id="numeroCompte"
        formControlName="numeroCompte"
        class="form-control"
        placeholder="Ex: ACC001"
        [class.invalid]="isFieldInvalid('numeroCompte')"
      />
      @if (isFieldInvalid('numeroCompte')) {
        <span class="error-message">{{ getFieldError('numeroCompte') }}</span>
      }
    </div>

    @if (operationType() === 'virement') {
      <div class="form-group">
        <label for="compteDestinataire">Compte Destinataire *</label>
        <input
          type="text"
          id="compteDestinataire"
          formControlName="compteDestinataire"
          class="form-control"
          placeholder="Ex: ACC002"
          [class.invalid]="isFieldInvalid('compteDestinataire')"
        />
        @if (isFieldInvalid('compteDestinataire')) {
          <span class="error-message">{{ getFieldError('compteDestinataire') }}</span>
        }
      </div>
    }

    <div class="form-group">
      <label for="montant">Montant (FCFA) *</label>
      <input
        type="number"
        id="montant"
        formControlName="montant"
        class="form-control"
        placeholder="0.00"
        min="0.01"
        step="0.01"
        [class.invalid]="isFieldInvalid('montant')"
      />
      @if (isFieldInvalid('montant')) {
        <span class="error-message">{{ getFieldError('montant') }}</span>
      }
    </div>

    <div class="form-group">
      <label for="description">Description (optionnel)</label>
      <textarea
        id="description"
        formControlName="description"
        class="form-control"
        rows="3"
        placeholder="Ajoutez une note ou description..."
      ></textarea>
    </div>

    <div class="form-actions">
      <button type="button" (click)="resetForm()" class="btn btn-secondary" [disabled]="loading()">
        Réinitialiser
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="loading()">
        @if (loading()) {
          Traitement en cours...
        } @else {
          @switch (operationType()) {
            @case ('depot') { Effectuer le Dépôt }
            @case ('retrait') { Effectuer le Retrait }
            @case ('virement') { Effectuer le Virement }
          }
        }
      </button>
    </div>
  </form>
</div>
